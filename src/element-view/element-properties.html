<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="element-stuff-shared-styles.html">

<dom-module id="element-properties">
  <template>
    <style include="element-stuff-shared-styles"></style>
    <div class="content-wrapper">
      <dom-repeat items="[[props]]">
        <template>
          <button>{{item.name}}</button>
        </template>
      </dom-repeat>
    </div>
  </template>
  <script>
    class ElementProperties extends Polymer.Element {
      static get is() { return 'element-properties' }
      static get properties() {
        return {
          props: Array
        }
      }

      display(target, info) {
        if (target.id === 'viewContainer') {
          this.set("props", []);
          return;
        }
        let list = this._getCustomProperties(target, info);
        list.sort((a, b) => {
          let na = a.name.toUpperCase();
          let nb = b.name.toUpperCase();
          if (na < nb) return -1;
          if (na > nb) return 1;
          return 0;
        });
        this.set("props", list);
      }

      _getCustomProperties(target, info) {
        let list = [];
        if (target.tagName.indexOf('-') !== -1) {
          let attrs = target.constructor.observedAttributes || [];
          if (attrs.length) {
            var props = target.constructor.properties;
            if (props) {
              var keys = Object.keys(props);
              for (var i = 0; i < keys.length; i++) {
                var pname = keys[i];
                var p = props[pname];
                var typeFn = null;
                if (typeof p === 'function') {
                  typeFn = p;
                } else {
                  typeFn = p.type;
                }
                list.push({
                  name: pname,
                  type: typeFn ? (typeFn.name || "String") : "String",
                  value: target[pname]
                });
              }
            }
          }
        }
        if (info.textContent) {
          list.push({
            name: "textContent",
            type: "String",
            value: target.textContent
          });
        }
        console.log(list);
        return list;
      }
    }
    window.customElements.define(ElementProperties.is, ElementProperties);
  </script>
</dom-module>